import{d as M,u as I,r,a as i,c as d,b as e,k as Q,w as F,v as L,p as A,f as N,o as W,F as k,i as E,t as w,y as V,z as X,q as Y,h as S,g as _}from"./index-C4Py5GRL.js";import{_ as Z,a as ee,b as te}from"./ComponentCard.vue_vue_type_script_setup_true_lang-vmA5x9ea.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const se={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},ae={class:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},re={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full dark:bg-gray-800"},oe={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4 dark:bg-gray-800"},le={class:"space-y-4"},ie=M({__name:"AddApplicationButton",setup(z){const g=I(),v=N(),c=r([]);r(!1);const f=r(!1);r(!1),r(null),r({id:null,username:"",password:"",is_active:!0,balance:0});const m=r({app_id:""}),b=()=>{m.value={app_id:""},f.value=!0},x=()=>{f.value=!1},y=async()=>{try{const n=localStorage.getItem("accessToken"),o=await fetch("/dashboard/api/v1/applications",{method:"POST",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify(m.value)});if(!o.ok)if(o.status===401){if(await g.refresh())return await retryOriginalRequest();g.logout(),v.push("/")}else console.error("Ошибка запроса:",await o.json());const h=await o.json();c.value.push(h),x()}catch(n){console.error("Error creating account:",n)}};return(n,o)=>(i(),d("div",null,[e("div",{class:"flex justify-end"},[e("button",{onClick:b,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:bg-blue-500 dark:hover:bg-blue-600"},o[1]||(o[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z","clip-rule":"evenodd"})],-1),Q(" Добавить новое приложение ")]))]),f.value?(i(),d("div",se,[e("div",ae,[e("div",{class:"fixed inset-0 transition-opacity","aria-hidden":"true",onClick:x},o[2]||(o[2]=[e("div",{class:"absolute inset-0 bg-gray-500 opacity-75 dark:bg-gray-900 dark:opacity-75"},null,-1)])),o[5]||(o[5]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",re,[e("div",oe,[o[4]||(o[4]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4"},"Добавить новое приложение",-1)),e("div",le,[e("div",null,[o[3]||(o[3]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"App Bundle ID",-1)),F(e("input",{"onUpdate:modelValue":o[0]||(o[0]=h=>m.value.app_id=h),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white sm:text-sm"},null,512),[[L,m.value.app_id]])])])]),e("div",{class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse dark:bg-gray-800"},[e("button",{type:"button",onClick:y,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:ml-3 sm:w-auto sm:text-sm"}," Создать "),e("button",{type:"button",onClick:x,class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm dark:bg-gray-700 dark:text-white dark:border-gray-600 dark:hover:bg-gray-600"}," Отменить ")])])])])):A("",!0)]))}}),ne={class:"overflow-hidden rounded-xl border border-gray-200 bg-white dark:border-gray-800 dark:bg-white/[0.03]"},de={class:"max-w-full overflow-x-auto custom-scrollbar"},ce={class:"min-w-full"},ue={class:"divide-y divide-gray-200 dark:divide-gray-700"},me={class:"px-5 py-4 sm:px-6 text-theme-sm"},pe={class:"block font-medium text-gray-800 text-theme-sm dark:text-white/90"},ge={class:"px-5 py-4 sm:px-6 text-theme-sm text-gray-600 dark:text-gray-400"},fe={class:"px-5 py-4 sm:px-6"},be={class:"flex items-center space-x-2"},xe=["onClick"],ye=["onClick"],he={key:0,class:"fixed inset-0 z-50 overflow-y-auto"},ve={class:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},we={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-4xl sm:w-full dark:bg-gray-800"},ke={class:"bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4 dark:bg-gray-800"},_e={class:"space-y-6"},Ce={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-44 overflow-y-auto p-2"},je=["onClick"],Te={class:"flex items-start space-x-3"},$e=["src"],Ee={class:"text-sm font-medium text-gray-900 dark:text-white"},Se={class:"text-xs text-gray-500 dark:text-gray-400"},Ae={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 max-h-44 overflow-y-auto p-2"},Me=["onClick"],ze={class:"flex items-start space-x-3"},Be=["src"],De={class:"text-sm font-medium text-gray-900 dark:text-white"},Ve={key:1,class:"fixed inset-0 z-50 overflow-y-auto"},Ie={class:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},Fe={class:"inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full dark:bg-gray-800"},Le={class:"bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse dark:bg-gray-800"},Ne=["disabled"],Oe={key:0},qe={key:1},Ue=M({__name:"BasicTableFour",setup(z){const g=N(),v=I(),c=r([]),f=r(!1),m=r(!1),b=r(null),x=r(!1),y=r(!1),n=r({id:null,app_id:"",template_ids:[],style_ids:[]});r(null),r(null);const o=r([]),h=r([]),u=r([]),p=r([]),B=async s=>{try{if(!await v.refresh()){v.logout(),g.push("/");return}await s()}catch(t){console.error("Ошибка при повторном запросе:",t),g.push({name:"Error"})}},C=async()=>{try{const s=await fetch("/dashboard/api/v1/applications");if(!s.ok)throw new Error("Failed to fetch applications");c.value=await s.json()}catch(s){console.error("Error fetching applications:",s)}},O=async()=>{try{const s=await fetch("/dashboard/api/v1/templates");if(!s.ok)throw new Error("Failed to fetch templates");o.value=await s.json()}catch(s){console.error("Error fetching templates:",s)}},q=async()=>{try{const s=await fetch("/dashboard/api/v1/styles");if(!s.ok)throw new Error("Failed to fetch styles");h.value=await s.json()}catch(s){console.error("Error fetching styles:",s)}},U=s=>{var t,a;n.value={id:s.id,app_id:s.app_id,template_ids:((t=s.templates)==null?void 0:t.map(l=>l.id))||[],style_ids:((a=s.styles)==null?void 0:a.map(l=>l.id))||[]},u.value=[...n.value.template_ids],p.value=[...n.value.style_ids],f.value=!0},j=()=>{f.value=!1,u.value=[],p.value=[]},H=s=>{b.value=s,m.value=!0},T=()=>{m.value=!1,b.value=null},P=s=>{const t=u.value.indexOf(s);t===-1?u.value.push(s):u.value.splice(t,1)},R=s=>{const t=p.value.indexOf(s);t===-1?p.value.push(s):p.value.splice(t,1)},J=async()=>{x.value=!0;try{const s=localStorage.getItem("accessToken"),t={app_id:n.value.app_id,template_ids:u.value,style_ids:p.value},a=async()=>{const l=await fetch(`/dashboard/api/v1/applications/${n.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(t)});if(!l.ok){if(l.status===401)return await B(a);{const $=await l.json();throw new Error($.message||"Failed to update application")}}const K=await l.json(),D=c.value.findIndex($=>$.id===n.value.id);D!==-1&&(c.value[D]=K),j(),await C()};await a()}catch(s){console.error("Error updating application:",s)}finally{x.value=!1}},G=async()=>{y.value=!0;try{const s=localStorage.getItem("accessToken"),t=async()=>{const a=await fetch(`/dashboard/api/v1/applications/${b.value}`,{method:"DELETE",headers:{Authorization:`Bearer ${s}`}});if(!a.ok){if(a.status===401)return await B(t);throw new Error(await a.text())}c.value=c.value.filter(l=>l.id!==b.value),T(),await C()};await t()}catch(s){console.error("Error deleting application:",s)}finally{y.value=!1}};return W(()=>{C(),O(),q()}),(s,t)=>(i(),d(k,null,[e("div",ne,[e("div",de,[e("table",ce,[t[3]||(t[3]=e("thead",null,[e("tr",{class:"border-b border-gray-200 dark:border-gray-700"},[e("th",{class:"px-5 py-3 text-left w-3/11 sm:px-6"},[e("p",{class:"font-medium text-gray-500 text-theme-xs dark:text-gray-400"},"ID")]),e("th",{class:"px-5 py-3 text-left w-3/11 sm:px-6"},[e("p",{class:"font-medium text-gray-500 text-theme-xs dark:text-gray-400"},"App Bundle ID")]),e("th",{class:"px-5 py-3 text-left w-1/11 sm:px-6"},[e("p",{class:"font-medium text-gray-500 text-theme-xs dark:text-gray-400"},"Actions")])])],-1)),e("tbody",ue,[(i(!0),d(k,null,E(c.value,a=>(i(),d("tr",{key:a.id,class:"border-t border-gray-100 dark:border-gray-800"},[e("td",me,[e("span",pe,w(a.id),1)]),e("td",ge,w(a.app_id),1),e("td",fe,[e("div",be,[e("button",{onClick:l=>U(a),class:"p-1 text-gray-500 hover:text-blue-600 dark:text-gray-400 dark:hover:text-blue-400"},t[1]||(t[1]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})],-1)]),8,xe),e("button",{onClick:l=>H(a.id),class:"p-1 text-gray-500 hover:text-red-600 dark:text-gray-400 dark:hover:text-red-400"},t[2]||(t[2]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[e("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)]),8,ye)])])]))),128))])])])]),f.value?(i(),d("div",he,[e("div",ve,[e("div",{class:"fixed inset-0 transition-opacity","aria-hidden":"true",onClick:j},t[4]||(t[4]=[e("div",{class:"absolute inset-0 bg-gray-500 opacity-75 dark:bg-gray-900 dark:opacity-75"},null,-1)])),t[9]||(t[9]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",we,[e("div",ke,[t[8]||(t[8]=e("h3",{class:"text-lg leading-6 font-medium text-gray-900 dark:text-white mb-4"},"Изменить связку шаблонов и стилей",-1)),e("div",_e,[e("div",null,[t[5]||(t[5]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300"},"App ID",-1)),F(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>n.value.app_id=a),type:"text",class:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white sm:text-sm"},null,512),[[L,n.value.app_id]])]),e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Шаблоны",-1)),e("div",Ce,[(i(!0),d(k,null,E(o.value,a=>(i(),d("div",{key:a.id,onClick:l=>P(a.id),class:V(["border rounded-lg p-3 cursor-pointer transition-all",{"border-blue-500 bg-blue-50 dark:bg-blue-900/30":u.value.includes(a.id),"border-gray-200 dark:border-gray-600":!u.value.includes(a.id)}])},[e("div",Te,[e("video",{src:a.preview_small,class:"h-12 w-12 rounded flex-shrink-0 object-cover",muted:"",loop:"",autoplay:""},null,8,$e),e("div",null,[e("h4",Ee,w(a.name),1),e("p",Se,w(a.category),1)])])],10,je))),128))])]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},"Стили",-1)),e("div",Ae,[(i(!0),d(k,null,E(h.value,a=>(i(),d("div",{key:a.id,onClick:l=>R(a.id),class:V(["border rounded-lg p-3 cursor-pointer transition-all",{"border-blue-500 bg-blue-50 dark:bg-blue-900/30":p.value.includes(a.id),"border-gray-200 dark:border-gray-600":!p.value.includes(a.id)}])},[e("div",ze,[e("video",{src:a.preview_small,class:"h-12 w-12 rounded flex-shrink-0 object-cover",muted:"",loop:"",autoplay:""},null,8,Be),e("div",null,[e("h4",De,w(a.name),1)])])],10,Me))),128))])])]),e("div",{class:"mt-6 flex justify-end space-x-3"},[e("button",{type:"button",onClick:j,class:"inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm dark:bg-gray-700 dark:text-white dark:border-gray-600 dark:hover:bg-gray-600"}," Отменить "),e("button",{type:"button",onClick:J,class:"inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-blue-600 text-base font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:text-sm"}," Сохранить ")])])])])])):A("",!0),m.value?(i(),d("div",Ve,[e("div",Ie,[e("div",{class:"fixed inset-0 transition-opacity","aria-hidden":"true",onClick:T},t[10]||(t[10]=[e("div",{class:"absolute inset-0 bg-gray-500 opacity-75 dark:bg-gray-900 dark:opacity-75"},null,-1)])),t[12]||(t[12]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",Fe,[t[11]||(t[11]=X('<div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4 dark:bg-gray-800"><div class="sm:flex sm:items-start"><div class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-red-100 sm:mx-0 sm:h-10 sm:w-10"><svg class="h-6 w-6 text-red-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg></div><div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left"><h3 class="text-lg leading-6 font-medium text-gray-900 dark:text-white">Удалить приложение</h3><div class="mt-2"><p class="text-sm text-gray-500 dark:text-gray-400">Вы уверены, что хотите удалить приложение? Это действие будет невозвратно.</p></div></div></div></div>',1)),e("div",Le,[e("button",{type:"button",onClick:G,disabled:y.value,class:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50 disabled:cursor-not-allowed"},[y.value?(i(),d("span",Oe,"Deleting...")):(i(),d("span",qe,"Удалить"))],8,Ne),e("button",{type:"button",onClick:T,class:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm dark:bg-gray-700 dark:text-white dark:border-gray-600 dark:hover:bg-gray-600"}," Отменить ")])])])])):A("",!0)],64))}}),He={class:"space-y-5 sm:space-y-6"},Ge=M({__name:"ApplicationTable",setup(z){const g=r("Приложения");return(v,c)=>(i(),Y(te,null,{default:S(()=>[_(Z,{pageTitle:g.value},null,8,["pageTitle"]),e("div",He,[_(ee,{title:"Приложения"},{action:S(()=>[_(ie)]),default:S(()=>[_(Ue)]),_:1})])]),_:1}))}});export{Ge as default};
