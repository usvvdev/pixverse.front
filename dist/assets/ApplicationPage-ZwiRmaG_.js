import{d as S,a as g,c as f,b as e,t as y,l as M,r as h,m as R,o as T,e as j,w as p,v as m,n as O,F as B,i as D,p as q,q as N,u as L,g as C,h as U,k as E,s as I,f as F,j as J}from"./index-CbNS34Wk.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"card"},H={class:"card-header"},K=["title"],Q={class:"app-description"},W={class:"app-id-section"},X={class:"app-id"},Y=S({__name:"ApplicationCard",props:{application_id:{},name:{},description:{}},setup(k){return(c,d)=>(g(),f("div",G,[e("div",H,[e("h2",{class:"app-name",title:c.name},y(c.name),9,K)]),e("p",Q,y(c.description||"Описание недоступно"),1),e("div",W,[d[0]||(d[0]=e("p",{class:"app-id-label"},"ID приложения:",-1)),e("div",X,y(c.application_id),1)]),d[1]||(d[1]=e("button",{class:"btn-primary btn-manage"},"Управление",-1))]))}}),Z=z(Y,[["__scopeId","data-v-38adae94"]]),ee={class:"fixed inset-0 bg-white dark:bg-gray-900 z-50 overflow-auto p-6"},te={class:"max-w-4xl mx-auto w-full"},oe={class:"text-xl font-semibold text-gray-800 dark:text-white mb-4"},se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ae={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},le={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 max-h-64 overflow-y-auto"},ne=["onClick"],ie={class:"text-sm font-medium text-gray-900 dark:text-white"},re={class:"text-xs text-gray-500 dark:text-gray-400"},de={class:"pt-4 flex justify-between flex-wrap gap-3"},ue={key:0},pe={class:"flex gap-3 ml-auto"},ce=S({__name:"AddApplication",props:{modelValue:{}},emits:["update:modelValue","close","save","delete"],setup(k,{emit:c}){const d=k,u=c,s=M({id:"",application_id:"",description:"",name:"",region:"",store_region:"",application_number:"",category:"",start_date:"",release_date:"",technology:"",products:[]}),b=!!d.modelValue,v=h([]),x=async()=>{try{const n=localStorage.getItem("accessToken"),t=await fetch("/dashboard/api/v1/products",{headers:{Authorization:`Bearer ${n}`}});if(!t.ok)throw new Error("Ошибка загрузки продуктов");v.value=await t.json()}catch(n){console.error(n)}},_=n=>{var o,a,l;const t=((o=s.products)==null?void 0:o.findIndex(i=>i.id===n.id))??-1;t>=0?(a=s.products)==null||a.splice(t,1):(l=s.products)==null||l.push(n)},w=n=>{var t;return(t=s.products)==null?void 0:t.some(o=>o.id===n.id)};R(()=>d.modelValue,n=>{var t,o;n?Object.assign(s,{...n,start_date:((t=n.start_date)==null?void 0:t.slice(0,10))??"",release_date:((o=n.release_date)==null?void 0:o.slice(0,10))??"",products:n.products??[]}):(Object.keys(s).forEach(a=>{s[a]=""}),s.products=[])},{immediate:!0}),T(()=>{x()});const $=()=>{u("save",{...s})},A=()=>{s.id&&u("delete",s.id)};return(n,t)=>(g(),f("div",ee,[e("div",te,[e("h2",oe,y(b?"Редактировать приложение":"Добавить приложение"),1),e("form",{onSubmit:j($,["prevent"]),class:"space-y-5"},[e("div",null,[t[11]||(t[11]=e("label",{class:"label"},"Название",-1)),p(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>s.name=o),class:"input",placeholder:"Название приложения",required:""},null,512),[[m,s.name]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"label"},"Bundle ID приложения",-1)),p(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>s.application_id=o),class:"input",placeholder:"ID приложения",required:""},null,512),[[m,s.application_id]])]),e("div",null,[t[13]||(t[13]=e("label",{class:"label"},"Описание приложения",-1)),p(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.description=o),class:"input",placeholder:"Описание приложения",required:""},null,512),[[m,s.description]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"label"},"Регион размещения",-1)),p(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s.region=o),class:"input",placeholder:"Напр. US, EU, RU"},null,512),[[m,s.region]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"label"},"Регион App Store",-1)),p(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>s.store_region=o),class:"input"},null,512),[[m,s.store_region]])]),e("div",se,[e("div",null,[t[16]||(t[16]=e("label",{class:"label"},"ID Приложения",-1)),p(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.application_number=o),class:"input"},null,512),[[m,s.application_number]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"label"},"Категория",-1)),p(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>s.category=o),class:"input"},null,512),[[m,s.category]])])]),e("div",ae,[e("div",null,[t[18]||(t[18]=e("label",{class:"label"},"Дата начала",-1)),p(e("input",{type:"date","onUpdate:modelValue":t[7]||(t[7]=o=>s.start_date=o),class:"input"},null,512),[[m,s.start_date]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"label"},"Дата релиза",-1)),p(e("input",{type:"date","onUpdate:modelValue":t[8]||(t[8]=o=>s.release_date=o),class:"input"},null,512),[[m,s.release_date]])])]),e("div",null,[t[21]||(t[21]=e("label",{class:"label"},"Технология",-1)),p(e("select",{"onUpdate:modelValue":t[9]||(t[9]=o=>s.technology=o),class:"input"},t[20]||(t[20]=[e("option",{disabled:"",value:""},"Выберите тип",-1),e("option",null,"Native",-1),e("option",null,"Flutter",-1),e("option",null,"React Native",-1),e("option",null,"Swift",-1),e("option",null,"Python",-1)]),512),[[O,s.technology]])]),e("div",null,[t[22]||(t[22]=e("label",{class:"label"},"Продукты",-1)),e("div",le,[(g(!0),f(B,null,D(v.value,o=>(g(),f("div",{key:o.id,onClick:a=>_(o),class:q(["cursor-pointer border rounded-lg p-4 transition-all",{"border-blue-500 bg-blue-50 dark:bg-blue-900/30":w(o),"border-gray-200 dark:border-gray-600":!w(o)}])},[e("h4",ie,y(o.name),1),e("p",re,"Токенов: "+y(o.tokens_amount),1)],10,ne))),128))])]),e("div",de,[b?(g(),f("div",ue,[e("button",{type:"button",onClick:A,class:"px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700"}," Удалить ")])):N("",!0),e("div",pe,[e("button",{type:"button",onClick:t[10]||(t[10]=o=>n.$emit("close")),class:"px-4 py-2 rounded bg-gray-300 hover:bg-gray-400 dark:bg-gray-700 dark:hover:bg-gray-600"}," Отмена "),t[23]||(t[23]=e("button",{type:"submit",class:"px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700"}," Сохранить ",-1))])])],32)])]))}}),me=z(ce,[["__scopeId","data-v-85677ad8"]]),ge={class:"min-h-screen bg-white dark:bg-gray-900"},be={class:"border-b border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-900"},ve={class:"max-w-7xl mx-auto px-4 py-4 flex gap-6"},fe={class:"max-w-7xl mx-auto px-4 py-6"},ye={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5"},he=S({__name:"ApplicationPage",setup(k){const c=F(),d=L(),u=h([]),s=h(!1),b=h(null),v=async a=>{try{if(!await d.refresh()){d.logout(),c.push("/login");return}await a()}catch(l){console.error("Ошибка выполнения действия:",l),c.push({name:"Error"})}},x=async()=>{await v(async()=>{const a=localStorage.getItem("accessToken"),l=await fetch("/dashboard/api/v1/store_applications",{headers:{Authorization:`Bearer ${a}`}});if(!l.ok)throw new Error("Ошибка загрузки приложений");const i=await l.json();u.value=i})},_=async a=>{await v(async()=>{const l=localStorage.getItem("accessToken"),i=await fetch("/dashboard/api/v1/store_applications",{method:"POST",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok)throw new Error("Ошибка при создании приложения");const r=await i.json();u.value.push(r)})},w=async a=>{await v(async()=>{const l=localStorage.getItem("accessToken"),i=await fetch(`/dashboard/api/v1/store_applications/${a.id}`,{method:"PUT",headers:{Authorization:`Bearer ${l}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(!i.ok)throw new Error("Ошибка при обновлении приложения");const r=await i.json(),V=u.value.findIndex(P=>P.id===a.id);V!==-1&&(u.value[V]=r)})},$=async a=>{await v(async()=>{const l=localStorage.getItem("accessToken");if(!(await fetch(`/dashboard/api/v1/store_applications/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${l}`}})).ok)throw new Error("Ошибка при удалении приложения");u.value=u.value.filter(r=>r.id!==a),await x(),t()})};function A(){b.value=null,s.value=!0}function n(a){b.value={...a},s.value=!0}function t(){s.value=!1,b.value=null}async function o(a){a.id?await w(a):await _(a),await x(),t()}return T(x),(a,l)=>{const i=J("RouterLink");return g(),f("div",ge,[e("nav",be,[e("div",ve,[C(i,{to:"/main",class:"text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-white","active-class":"text-blue-600 dark:text-white font-semibold underline underline-offset-4"},{default:U(()=>l[1]||(l[1]=[E(" Главная ")])),_:1}),C(i,{to:"/applications",class:"text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-blue-600 dark:hover:text-white","active-class":"text-blue-600 dark:text-white font-semibold underline underline-offset-4"},{default:U(()=>l[2]||(l[2]=[E(" Приложения ")])),_:1})])]),e("header",{class:"border-b border-gray-100 dark:border-gray-800"},[e("div",{class:"max-w-7xl mx-auto px-4 py-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-4"},[l[3]||(l[3]=e("div",null,[e("h1",{class:"text-xl font-normal text-gray-800 dark:text-gray-200"}," Приложения "),e("p",{class:"mt-1 text-sm text-gray-500 dark:text-gray-400"}," Управляйте своими приложениями и API-подключениями ")],-1)),e("button",{onClick:A,class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg"}," + Добавить приложение ")])]),e("main",fe,[e("div",ye,[(g(!0),f(B,null,D(u.value,r=>(g(),I(Z,{key:r.id,application_id:r.application_id,name:r.name,description:r.description,onClick:j(V=>n(r),["prevent"]),class:"cursor-pointer"},null,8,["application_id","name","description","onClick"]))),128))])]),s.value?(g(),I(me,{key:0,modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=r=>b.value=r),onClose:t,onSave:o,onDelete:$},null,8,["modelValue"])):N("",!0)])}}});export{he as default};
